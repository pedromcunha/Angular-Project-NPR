/*Trailer Parke 24-11-2014 */
var appDependencies=["templates-main","appFiltersModule","HeaderControllerModule","appDirectiveModule","appFactoriesModule","userFactoryModule","ui.router","ngCookies","ui.bootstrap"],app=angular.module("trailerParke",appDependencies),searchInput;app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("/",{url:"/",templateUrl:"../public/templates/trailer-listings.html",controller:"videoListingController"})}]),app.constant("apiKeys",{youtubeAPI:"AIzaSyDYhqH1guvlxxocuttrwxE2kkvYefu0cqo",rottenTomatoesAPI:"4cwjthjq2hyxz7amh6jj5p4p"}),app.constant("trailerParkeApi",{userRegistration:"http://localhost:1337/api/register",userLogin:"http://localhost:1337/auth/login"}),function(){function a(a,b,c){var d=this;d.genres=[{name:"horror",id:10},{name:"sci-fi",id:13},{name:"drama",id:6},{name:"comedy",id:4},{name:"thriller"},{name:"documentary"},{name:"animation",id:2},{name:"action",id:1},{name:"romance",id:12},{name:"crime",id:5},{name:"family",id:8},{name:"sports",id:15},{name:"adventure",id:1},{name:"fantasy"},{name:"history"},{name:"mystery",id:11},{name:"musical"},{name:"western"}],d.openRegistration=function(){c.open({templateUrl:"../public/templates/register-modal.html",controller:"RegistrationModalController",controllerAs:"modal"})},d.openLogin=function(){c.open({templateUrl:"../public/templates/login-modal.html",controller:"LoginModalController",controllerAs:"modal"})}}var b=angular.module("HeaderControllerModule",["userFactoryModule"]);a.prototype.autocompleteSearch=function(a){var b="http://api.rottentomatoes.com/api/public/v1.0/movies.json?apikey="+apiKeys.rottenTomatoesAPI+"&q="+a.split(" ").join("+")+"&page_limit=5&callback=JSON_CALLBACK",c=[],d="";a.length>5?rottenTomatoesService.getRatings(b).success(function(a){vm.ShowAutoSuggestions=!0;var b,e;if(a.movies.length>0){for(var f=0;f<a.movies.length;f++)b=a.movies[f].ratings.critics_score,e=a.movies[f].title,""!=e&&e.length<33?d=e:e.length>36&&(d=e.slice(0,36)+"..."),-1!=b&&e.length>0&&c.push({title:d,rating:b});vm.AutoSuggestions=c}}).error(function(){console.log("err")}):(vm.AutoSuggestions="",vm.Ratings="")},a.prototype.submitSearch=function(a){var b,c=vm.searchText;if(void 0==a)var a=vm.searchText,b="https://gdata.youtube.com/feeds/api/videos?q="+c.split(" ").join("+")+"+official+trailer&v=2&max-results=3&alt=json&category=movies&callback=JSON_CALLBACK";else b="https://gdata.youtube.com/feeds/api/videos?q="+a.split(" ").join("+")+"+official+trailer+-game&v=2&orderby=relevance&max-results=20&hd=true&alt=json&category=movies&callback=JSON_CALLBACK";youtubeApiService.getVideos(b).success(function(a){if(void 0!=a.feed.entry){for(var b=[],c=0,d=a.feed.entry.length;d>c;c++)b.push($sce.trustAsResourceUrl(a.feed.entry[c].link[0].href.replace("watch?v=","embed/").replace("&feature=youtube_gdata","")));sharedVideos.videos=b,vm.searchText=""}else sharedVideos.videos=""}).error(function(){console.log("err")})},a.prototype.selectGenre=function(a){vm.selected=a},a.prototype.genreClass=function(a){return a===vm.selected?"active":void 0},a.$inject=["$scope","$sce","$modal","apiKeys","rottenTomatoesService","youtubeApiService","sharedVideos"],b.controller("headerController",a),b.controller("videoListingController",["$scope","sharedVideos",function(a,b){a.programs=b}])}(),function(){function a(a,b,c){function d(){f.formSubmitted=!0,f.userLogin.$valid&&c.login(f.username,f.password).then(function(a){a&&(f.responseMessage=401==a.status||404==a.status?f.formatMessage(a.data.message,!1):f.formatMessage(a.data.message,!0))},function(a){f.responseMessage=f.formatMessage(a.data.message,!1)})}function e(){b.close()}var f=this;f.closeModal=e,f.login=d}var b=angular.module("HeaderControllerModule");a.prototype.formatMessage=function(a,b){function c(a,b){this.message=a,this.loggedIn=b}return new c(a,b)},a.$inject=["$scope","$modalInstance","userFactory"],b.controller("LoginModalController",a)}(),function(){function a(a,b,c){function d(){b.close()}function e(){f.formSubmitted=!0,f.userRegistrationForm.$valid&&c.registerUser(f.username,f.password).then(function(a){null===a.data.user?f.responseMessage=f.formatMessage(a.data.message,!1):(f.responseMessage=f.formatMessage(a.data.message,!0),setTimeout(d,5e3))},function(){f.responseMessage=formatMessage(response.data.message,!1)})}var f=this;f.closeModal=d,f.registerUser=e,f.formSubmitted=!1}var b=angular.module("HeaderControllerModule");a.prototype.formatMessage=function(a,b){function c(a,b){this.message=a,this.registered=b}return new c(a,b)},a.$inject=["$scope","$modalInstance","userFactory"],b.controller("RegistrationModalController",a)}(),function(){var a=angular.module("appDirectiveModule",[]);a.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}})}(),function(){var a=angular.module("appFactoriesModule",[]);a.factory("youtubeApiService",["$http",function(a){var b={};return b.getVideos=function(b){return a({method:"JSONP",url:b,cache:!0})},b}]),a.factory("rottenTomatoesService",["$http",function(a){var b={};return b.getRatings=function(b){return a({method:"JSONP",url:b,cache:!0})},b}]),a.factory("sharedVideos",function(){var a={};return a})}(),function(){function a(a,b){var c={registerUser:function(c,d){return a.post(b.userRegistration,{username:c,password:d})},login:function(c,d){return a({method:"POST",url:b.userLogin,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:{username:c,password:d}})}};return c}var b=angular.module("userFactoryModule",[]);a.$inject=["$http","trailerParkeApi"],b.factory("userFactory",a)}(),function(){var a=angular.module("appFiltersModule",[]);a.filter("capitalize",function(){return function(a){if(a instanceof Array){for(var b=0,c=a.length,d=[];c>b;b++)d.push(a[b][0].toUpperCase()+a[b].slice(1));return d}return a[0].toUpperCase()+a.slice(1)}})}();