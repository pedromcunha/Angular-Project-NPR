/*Trailer Parke 06-12-2014 */
angular.module("VideoListingModules",["VideoControllerModule","VideoServiceModule","VideoStorageFactoryModule"]),angular.module("UserModules",["UserStorageFactoryModule","UserFactoryModule"]);var appDependencies=["templates-main","appFiltersModule","HeaderControllerModule","VideoListingModules","appDirectiveModule","UserModules","appFactoriesModule","ui.router","ngCookies","ui.bootstrap"],app=angular.module("trailerParke",appDependencies),searchInput;app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("/",{url:"/",templateUrl:"../public/templates/trailer-listings.html",controller:"VideoListingController as vm"})}]),app.constant("apiKeys",{youtubeAPI:"AIzaSyDYhqH1guvlxxocuttrwxE2kkvYefu0cqo",rottenTomatoesAPI:"4cwjthjq2hyxz7amh6jj5p4p"}),app.constant("trailerParkeApi",{userRegistration:"http://localhost:1337/api/register",userLogin:"http://localhost:1337/auth/login",userById:"http://localhost:1337/api/user"}),function(){function a(a,b,c,d,e,f,g,h,i,j,k){var l=this;l.genres=[{name:"horror"},{name:"sci-fi"},{name:"drama"},{name:"comedy"},{name:"thriller"},{name:"documentary"},{name:"animation"},{name:"action"},{name:"romance"},{name:"crime"},{name:"family"},{name:"sports"},{name:"adventure"},{name:"fantasy"},{name:"history"},{name:"mystery"},{name:"musical"},{name:"western"}],l.searchSubmitted=!1,l.genre=null,l.videoStorage=j,a.$watch(function(){return h.user},function(a){l.userState=a,null===a||void 0===a?k.user=null:k.storeUser(a)}),l.openRegistration=function(){b.open({templateUrl:"../public/templates/register-modal.html",controller:"RegistrationModalController",controllerAs:"modal"})},l.openLogin=function(){b.open({templateUrl:"../public/templates/login-modal.html",controller:"LoginModalController",controllerAs:"modal"})},l.logOut=function(){g.remove("user")},l.searchYoutube=function(a,b){l.searchSubmitted=!0,l.genre=null,a&&i.queryYoutube(a,b,"getTrailer").then(function(a){l.videoStorage.videos=a,l.searchSubmitted=!1})},l.searchByGenre=function(a){l.genre=a,i.queryYoutube(a,21,"getTrailersByGenre").then(function(a){l.videoStorage.videos=a})}}var b=angular.module("HeaderControllerModule",["UserFactoryModule","ngCookies"]);a.$inject=["$scope","$modal","apiKeys","rottenTomatoesService","youtubeApiService","sharedVideos","$cookieStore","$cookies","VideoListingService","VideoStorage","UserStorage"],b.controller("headerController",a)}(),function(){function a(a,b,c){this.queryYoutube=function(a,d,e){return b[e](a,d).then(function(a){if(a){var b=a.data.items,d=[];return _.each(b,function(a){d.push(c.trustAsResourceUrl("https://www.youtube.com/embed/"+a.id.videoId))}),d}}).catch(function(a){return a})}}var b=angular.module("VideoServiceModule",["youtubeFactoryModule"]);a.$inject=["apiKeys","youtubeFactory","$sce"],b.service("VideoListingService",a)}(),function(){function a(a,b,c,d,e){function f(){h.formSubmitted=!0,h.userLogin.$valid&&c.login(h.username,h.password).then(function(a){a&&(401==a.status||404==a.status?h.responseMessage=h.formatMessage(a.data.message,!1):(h.responseMessage=h.formatMessage(a.data.message,!0),d.user=a.data.user._id,e(g,1e3)))},function(a){h.responseMessage=h.formatMessage(a.data.message,!1)})}function g(){b.close()}var h=this;h.closeModal=g,h.login=f}var b=angular.module("HeaderControllerModule");a.prototype.formatMessage=function(a,b){function c(a,b){this.message=a,this.loggedIn=b}return new c(a,b)},a.$inject=["$scope","$modalInstance","userFactory","$cookies","$timeout"],b.controller("LoginModalController",a)}(),function(){function a(a,b,c,d){function e(){b.close()}function f(){g.formSubmitted=!0,g.userRegistrationForm.$valid&&c.registerUser(g.username,g.password).then(function(a){null===a.data.user?g.responseMessage=g.formatMessage(a.data.message,!1):(g.responseMessage=g.formatMessage(a.data.message,!0),d(e,5e3))},function(){g.responseMessage=formatMessage(response.data.message,!1)})}var g=this;g.closeModal=e,g.registerUser=f,g.formSubmitted=!1}var b=angular.module("HeaderControllerModule");a.prototype.formatMessage=function(a,b){function c(a,b){this.message=a,this.registered=b}return new c(a,b)},a.$inject=["$scope","$modalInstance","userFactory","$timeout"],b.controller("RegistrationModalController",a)}(),function(){function a(a,b,c){var d=this;d.trailers=b,d.userState=c}var b=angular.module("VideoControllerModule",["ngCookies"]);a.$inject=["$scope","VideoStorage","UserStorage"],b.controller("VideoListingController",a)}(),function(){var a=angular.module("appDirectiveModule",[]);a.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}})}(),function(){var a=angular.module("appFactoriesModule",[]);a.factory("youtubeApiService",["$http",function(a){var b={};return b.getVideos=function(b){return a({method:"JSONP",url:b,cache:!0})},b}]),a.factory("rottenTomatoesService",["$http",function(a){var b={};return b.getRatings=function(b){return a({method:"JSONP",url:b,cache:!0})},b}]),a.factory("sharedVideos",function(){var a={};return a})}(),function(){function a(a,b){var c={registerUser:function(c,d){return a.post(b.userRegistration,{username:c,password:d})},login:function(c,d){return a.post(b.userLogin,{username:c,password:d})},getUser:function(c){return a.get(b.userById,{params:{id:c}})}};return c}var b=angular.module("UserFactoryModule",[]);a.$inject=["$http","trailerParkeApi"],b.factory("userFactory",a)}(),function(){function a(a){var b={};return b.storeUser=function(c){a.getUser(c).then(function(a){a&&(b.user=a.data.user)}).catch(function(a){return a})},b}var b=angular.module("UserStorageFactoryModule",[]);a.$inject=["userFactory"],b.factory("UserStorage",a)}(),function(){function a(){var a={};return a}var b=angular.module("VideoStorageFactoryModule",[]);b.factory("VideoStorage",a)}(),function(){function a(a,b,c){var d={getTrailer:function(b,d){return a.get("https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults="+d+"&order=rating&q="+b+"+official+trailer&type=video&videoDefinition=high&videoEmbeddable=true&key="+c.youtubeAPI)},getTrailersByGenre:function(b,d){var e="+-game+-gameplay";return"fantasy"===b&&(e+="+-final"),a.get("https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults="+d+"&order=rating&q="+b+"+official+movie+trailer"+e+"&type=video&videoDefinition=high&key="+c.youtubeAPI)}};return d}var b=angular.module("youtubeFactoryModule",[]);a.$inject=["$http","trailerParkeApi","apiKeys"],b.factory("youtubeFactory",a)}(),function(){var a=angular.module("appFiltersModule",[]);a.filter("capitalize",function(){return function(a){if(a instanceof Array){for(var b=0,c=a.length,d=[];c>b;b++)d.push(a[b][0].toUpperCase()+a[b].slice(1));return d}return a[0].toUpperCase()+a.slice(1)}}),a.filter("trusted",function(a){return function(b){return void 0!==b?a.getTrustedResourceUrl(b):void 0}})}();