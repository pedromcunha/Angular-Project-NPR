/*Trailer Parke 26-11-2014 */
var appDependencies=["templates-main","appFiltersModule","HeaderControllerModule","VideoControllerModule","appDirectiveModule","appFactoriesModule","userFactoryModule","ui.router","ngCookies","ui.bootstrap"],app=angular.module("trailerParke",appDependencies),searchInput;app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("/",{url:"/",templateUrl:"../public/templates/trailer-listings.html",controller:"VideoListingController"})}]),app.constant("apiKeys",{youtubeAPI:"AIzaSyDYhqH1guvlxxocuttrwxE2kkvYefu0cqo",rottenTomatoesAPI:"4cwjthjq2hyxz7amh6jj5p4p"}),app.constant("trailerParkeApi",{userRegistration:"http://localhost:1337/api/register",userLogin:"http://localhost:1337/auth/login"}),function(){function a(a,b,c,d,e,f,g,h,i){var j=this;j.genres=[{name:"horror",id:10},{name:"sci-fi",id:13},{name:"drama",id:6},{name:"comedy",id:4},{name:"thriller"},{name:"documentary"},{name:"animation",id:2},{name:"action",id:1},{name:"romance",id:12},{name:"crime",id:5},{name:"family",id:8},{name:"sports",id:15},{name:"adventure",id:1},{name:"fantasy"},{name:"history"},{name:"mystery",id:11},{name:"musical"},{name:"western"}],a.$watch(function(){return i.user},function(a){j.userState=a}),j.openRegistration=function(){c.open({templateUrl:"../public/templates/register-modal.html",controller:"RegistrationModalController",controllerAs:"modal"})},j.openLogin=function(){c.open({templateUrl:"../public/templates/login-modal.html",controller:"LoginModalController",controllerAs:"modal"})},j.logOut=function(){h.remove("user")}}var b=angular.module("HeaderControllerModule",["userFactoryModule","ngCookies"]);a.prototype.autocompleteSearch=function(a){var b="http://api.rottentomatoes.com/api/public/v1.0/movies.json?apikey="+apiKeys.rottenTomatoesAPI+"&q="+a.split(" ").join("+")+"&page_limit=5&callback=JSON_CALLBACK",c=[],d="";a.length>5?rottenTomatoesService.getRatings(b).success(function(a){vm.ShowAutoSuggestions=!0;var b,e;if(a.movies.length>0){for(var f=0;f<a.movies.length;f++)b=a.movies[f].ratings.critics_score,e=a.movies[f].title,""!=e&&e.length<33?d=e:e.length>36&&(d=e.slice(0,36)+"..."),-1!=b&&e.length>0&&c.push({title:d,rating:b});vm.AutoSuggestions=c}}).error(function(){console.log("err")}):(vm.AutoSuggestions="",vm.Ratings="")},a.prototype.submitSearch=function(a){var b,c=vm.searchText;if(void 0==a)var a=vm.searchText,b="https://gdata.youtube.com/feeds/api/videos?q="+c.split(" ").join("+")+"+official+trailer&v=2&max-results=3&alt=json&category=movies&callback=JSON_CALLBACK";else b="https://gdata.youtube.com/feeds/api/videos?q="+a.split(" ").join("+")+"+official+trailer+-game&v=2&orderby=relevance&max-results=20&hd=true&alt=json&category=movies&callback=JSON_CALLBACK";youtubeApiService.getVideos(b).success(function(a){if(void 0!=a.feed.entry){for(var b=[],c=0,d=a.feed.entry.length;d>c;c++)b.push($sce.trustAsResourceUrl(a.feed.entry[c].link[0].href.replace("watch?v=","embed/").replace("&feature=youtube_gdata","")));sharedVideos.videos=b,vm.searchText=""}else sharedVideos.videos=""}).error(function(){console.log("err")})},a.prototype.selectGenre=function(a){vm.selected=a},a.prototype.genreClass=function(a){return a===vm.selected?"active":void 0},a.$inject=["$scope","$sce","$modal","apiKeys","rottenTomatoesService","youtubeApiService","sharedVideos","$cookieStore","$cookies"],b.controller("headerController",a)}(),function(){function a(a,b,c,d,e){function f(){h.formSubmitted=!0,h.userLogin.$valid&&c.login(h.username,h.password).then(function(a){a&&(401==a.status||404==a.status?h.responseMessage=h.formatMessage(a.data.message,!1):(h.responseMessage=h.formatMessage(a.data.message,!0),d.user=a.data.user._id,e(g,1e3)))},function(a){h.responseMessage=h.formatMessage(a.data.message,!1)})}function g(){b.close()}var h=this;h.closeModal=g,h.login=f}var b=angular.module("HeaderControllerModule");a.prototype.formatMessage=function(a,b){function c(a,b){this.message=a,this.loggedIn=b}return new c(a,b)},a.$inject=["$scope","$modalInstance","userFactory","$cookies","$timeout"],b.controller("LoginModalController",a)}(),function(){function a(a,b,c,d){function e(){b.close()}function f(){g.formSubmitted=!0,g.userRegistrationForm.$valid&&c.registerUser(g.username,g.password).then(function(a){null===a.data.user?g.responseMessage=g.formatMessage(a.data.message,!1):(g.responseMessage=g.formatMessage(a.data.message,!0),d(e,5e3))},function(){g.responseMessage=formatMessage(response.data.message,!1)})}var g=this;g.closeModal=e,g.registerUser=f,g.formSubmitted=!1}var b=angular.module("HeaderControllerModule");a.prototype.formatMessage=function(a,b){function c(a,b){this.message=a,this.registered=b}return new c(a,b)},a.$inject=["$scope","$modalInstance","userFactory","$timeout"],b.controller("RegistrationModalController",a)}(),function(){function a(a,b){var c=this;c.programs=b}var b=angular.module("VideoControllerModule",["ngCookies"]);a.$inject=["$scope","sharedVideos"],b.controller("VideoListingController",a)}(),function(){var a=angular.module("appDirectiveModule",[]);a.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}})}(),function(){var a=angular.module("appFactoriesModule",[]);a.factory("youtubeApiService",["$http",function(a){var b={};return b.getVideos=function(b){return a({method:"JSONP",url:b,cache:!0})},b}]),a.factory("rottenTomatoesService",["$http",function(a){var b={};return b.getRatings=function(b){return a({method:"JSONP",url:b,cache:!0})},b}]),a.factory("sharedVideos",function(){var a={};return a})}(),function(){function a(a,b){var c={registerUser:function(c,d){return a.post(b.userRegistration,{username:c,password:d})},login:function(c,d){return a.post(b.userLogin,{username:c,password:d})}};return c}var b=angular.module("userFactoryModule",[]);a.$inject=["$http","trailerParkeApi"],b.factory("userFactory",a)}(),function(){var a=angular.module("appFiltersModule",[]);a.filter("capitalize",function(){return function(a){if(a instanceof Array){for(var b=0,c=a.length,d=[];c>b;b++)d.push(a[b][0].toUpperCase()+a[b].slice(1));return d}return a[0].toUpperCase()+a.slice(1)}})}();